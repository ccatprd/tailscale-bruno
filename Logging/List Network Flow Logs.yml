info:
  name: List Network Flow Logs
  type: http
  seq: 2

http:
  method: GET
  url: "{{base_url}}/tailnet/{{tailnet}}/logging/network"
  auth:
    type: bearer
    token: "{{access_token}}"

runtime:
  scripts:
    - type: before-request
      code: |
        // Default window: last 5 minutes
        const now = new Date();
        const start = new Date(now.getTime() - 5 * 60 * 1000);
        const url = bru.getEnvVar("base_url") + "/tailnet/" + bru.getEnvVar("tailnet") + "/logging/network?start=" + start.toISOString() + "&end=" + now.toISOString();
        req.setUrl(url);

settings:
  encodeUrl: true
  timeout: 0
  followRedirects: true
  maxRedirects: 5
