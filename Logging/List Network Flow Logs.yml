info:
  name: List Network Flow Logs
  type: http
  seq: 2

http:
  method: GET
  url: "{{base_url}}/tailnet/{{tailnet}}/logging/network"
  auth:
    type: bearer
    token: "{{access_token}}"
  params:
    - name: start
      value: "{{log_start}}"
      enabled: true
    - name: end
      value: "{{log_end}}"
      enabled: true

runtime:
  scripts:
    - type: before-request
      code: |
        // Default window: last 5 minutes
        const now = new Date();
        const start = new Date(now.getTime() - 5 * 60 * 1000);
        bru.setEnvVar("log_end", now.toISOString());
        bru.setEnvVar("log_start", start.toISOString());

settings:
  encodeUrl: true
  timeout: 0
  followRedirects: true
  maxRedirects: 5
