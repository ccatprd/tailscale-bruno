info:
  name: List Devices
  type: http
  seq: 1

http:
  method: GET
  url: "{{base_url}}/tailnet/{{tailnet}}/devices"
  auth:
    type: bearer
    token: "{{access_token}}"

runtime:
  scripts:
    - type: after-response
      code: |
        const body = res.getBody();
        const devices = body && body.devices;
        if (devices && devices.length > 0) {
          bru.setEnvVar("device_id", devices[0].id);
          console.log("device_id set to: " + devices[0].id + " (" + devices[0].name + ")");
        } else {
          console.log("No devices found in response. Body: " + JSON.stringify(body));
        }

settings:
  encodeUrl: true
  timeout: 0
  followRedirects: true
  maxRedirects: 5
